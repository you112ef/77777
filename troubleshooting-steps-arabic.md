# خطوات استكشاف الأخطاء / Troubleshooting Steps

## إذا استمر ظهور خطأ 403 / If 403 Error Persists

### 1. تحقق من إعدادات المستودع / Check Repository Settings
```
Repository Settings → Actions → General → Workflow permissions
```
تأكد من اختيار: **"Read and write permissions"**

### 2. تحقق من بنية ملف الـ Workflow / Check Workflow File Structure
```yaml
name: APK Build
on: [push]

permissions:  # يجب أن يكون في نفس مستوى name و on
  contents: read
  issues: write
  pull-requests: write

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      # خطواتك هنا
```

### 3. تحقق من وجود الـ Issue / Verify Issue Exists
- تأكد من وجود Issue #1 في مستودعك
- أو قم بتغيير رقم الـ Issue في الكود

### 4. تحقق من السجلات / Check Workflow Logs
ابحث عن قسم **"Set up job"** في سجلات الـ workflow وتأكد من وجود:
```
permissions:
  issues: write
  pull-requests: write
  contents: read
```

### 5. حل بديل: استخدام Personal Access Token / Alternative: Use PAT
إذا استمر الخطأ، يمكنك إنشاء Personal Access Token:

1. اذهب إلى GitHub Settings → Developer settings → Personal access tokens
2. أنشئ token جديد مع صلاحية `repo`
3. أضف التوكن كـ secret في مستودعك
4. استخدمه في الـ workflow:

```yaml
- name: Comment on Issue
  uses: actions/github-script@v7
  with:
    github-token: ${{ secrets.YOUR_PAT_NAME }}
    script: |
      # نفس الكود السابق
```

## رسائل الخطأ الشائعة / Common Error Messages

### "Resource not accessible by integration"
- **السبب**: نقص في الصلاحيات
- **الحل**: إضافة `permissions: issues: write`

### "Not Found" أو 404
- **السبب**: Issue غير موجود
- **الحل**: تأكد من رقم الـ Issue الصحيح

### "Bad credentials" أو 401
- **السبب**: مشكلة في التوكن
- **الحل**: تحقق من صحة الـ GITHUB_TOKEN

## كود محسن للتعليق / Improved Comment Code

```yaml
- name: Comment on Issue with Error Handling
  uses: actions/github-script@v7
  with:
    script: |
      try {
        const comment = await github.rest.issues.createComment({
          issue_number: 1, // أو استخدم context.issue.number إذا كان متاحاً
          owner: context.repo.owner,
          repo: context.repo.repo,
          body: `## 📱 APK Build Complete ✅
          
          | File | Size | Download |
          |------|------|----------|
          | Debug APK | 6276363 bytes | [Download](${context.payload.repository.html_url}/actions/runs/${context.runId}) |
          | Release APK | 5050533 bytes | [Download](${context.payload.repository.html_url}/actions/runs/${context.runId}) |
          
          **Build Info:**
          - Commit: \`${context.sha.substring(0, 7)}\`
          - Build: #${context.runNumber}
          - Date: ${new Date().toISOString()}
          
          **Next Steps:**
          1. Download APK from Actions artifacts
          2. Install on Android device  
          3. Test sperm analysis functionality
          
          ---
          *Auto-generated by GitHub Actions*`
        });
        
        console.log('Comment created successfully:', comment.data.html_url);
      } catch (error) {
        console.error('Error creating comment:', error.message);
        console.error('Error details:', error.response?.data);
        throw error;
      }
```

## للمساعدة الإضافية / For Additional Help
أرسل لي:
1. محتوى ملف الـ workflow الكامل
2. سجلات الخطأ الحديثة
3. رابط المستودع (إذا كان عاماً)

Send me:
1. Complete workflow file content
2. Recent error logs  
3. Repository link (if public)